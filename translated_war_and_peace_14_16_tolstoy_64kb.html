<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>
   war_and_peace_14_16_tolstoy_64kb - HTML5 Audio Read
  </title>
  <meta content="width=device-width" name="viewport"/>
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
  <style>
   html {
    background: #333;
    font-family: Verdana, sans-serif;
}
body {
    background: white;
    padding: 1em;
    border-radius: 1em;
}
a {
    color: #0E2560;
}
h2 {
    margin-bottom: 1em;
}
.passage-audio {
    height: 2em;
}
#passage-audio {
    width: 100%;
    max-height: 2em;
}
#passage-text.speaking {
    -moz-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
.autofocus-current-word,
.playback-rate {
    font-size: smaller;
}
.autofocus-current-word label,
.playback-rate label {
    font-weight: bold;
}
q {
    quotes: "“" "”" "‘" "’";
}
.section-heading {
    display: none;
}
.passage p {
    line-height: 1.4em;
}
.verse-start {
    line-height: 0;
}
.initialized span[data-begin]:focus,
.initialized span[data-begin]:hover {
    background-color: #FFFFCA;
    box-shadow: 0px 0px 4px #FFFFCA;
}
.initialized span[data-begin].speaking {
    background-color: yellow;
    box-shadow: 0px 0px 4px yellow;
}
.initialized span[data-begin] {
    cursor: pointer;
}
.error {
    color: red;
}

article > footer {
    border-top: solid 1px gray;
    padding-top: 1em;
    margin-top: 1em;
}

footer {
    margin-bottom: 0.5em;
    line-height: 1.4em;
    font-size: small;
}
footer img {
    vertical-align: text-bottom;
}
  </style>
 </head>
 <body>
  <h1>
   war_and_peace_14_16_tolstoy_64kb
  </h1>
  <article>
   <p class="loading">
    <em>
     <img alt="Initializing audio" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="/>
     Loading audio…
    </em>
    <p>
    </p>
   </p>
   <p class="passage-audio" hidden="">
    <audio class="passage" controls="" id="passage-audio">
     <source src="war_and_peace_14_16_tolstoy_64kb.mp3" type="audio/mp3"/>
     <em class="error">
      <strong>
       Error:
      </strong>
      Your browser doesn't appear to support HTML5 Audio.
     </em>
    </audio>
    <p>
    </p>
   </p>
   <p class="passage-audio-unavailable" hidden="">
    <em class="error">
     <strong>
      Error:
     </strong>
     You will not be able to do the read-along audio because your browser is not able to play MP3, Ogg, or WAV audio formats.
    </em>
    <p>
    </p>
   </p>
   <p class="playback-rate" hidden="" title="Note that increaseing the reading rate will decrease accuracy of word highlights">
    <label for="playback-rate">
     Reading rate:
    </label>
    <input disabled="" id="playback-rate" max="2.0" min="0.5" onchange='this.nextElementSibling.textContent = String(Math.round(this.valueAsNumber * 10) / 10) + "\u00D7";' step="0.1" type="range" value="1.0"/>
    <output>
     1×
    </output>
    <p>
    </p>
   </p>
   <p class="playback-rate-unavailable" hidden="">
    <em>
     (It seems your browser does not support
     <code>
      HTMLMediaElement.playbackRate
     </code>
     , so you will not be able to change the speech rate.)
    </em>
    <p>
    </p>
   </p>
   <p class="autofocus-current-word" hidden="">
    <input checked="" id="autofocus-current-word" type="checkbox"/>
    <label for="autofocus-current-word">
     Auto-focus/auto-scroll
    </label>
    <p>
    </p>
   </p>
   <noscript>
    <p class="error">
     <em>
      <strong>
       Notice:
      </strong>
      You must have JavaScript enabled/available to try this HTML5 Audio read along.
     </em>
     <p>
     </p>
    </p>
   </noscript>
   <div class="passage" id="passage-text">
    <h3 class="section-heading">
     war_and_peace_14_16_tolstoy_64kb
    </h3>
    <p>
     <p>
     </p>
    </p>
    <p>
     <p>
     </p>
    </p>
    <p>
     <p>
     </p>
    </p>
    <p>
     <p>
     </p>
    </p>
    <p>
     <p>
     </p>
    </p>
    <p>
     <p>
     </p>
    </p>
    <p>
     <p>
     </p>
    </p>
    <p>
     ﻿CHAPTER XVI
     <p>
      第十六章
     </p>
    </p>
    <p>
     After the twenty-eighth of October when the frosts began, the flight of the French assumed a still more tragic character, with men freezing, or roasting themselves to death at the campfires, while carriages with people dressed in furs continued to drive past, carrying away the property that had been stolen by the Emperor, kings, and dukes; but the process of the flight and disintegration of the French army went on essentially as before.
     <p>
      10 月 28 日开始降霜后，法军的逃亡变得更加悲惨，人们或被冻死，或被烤死在篝火旁，而披着毛皮的马车则不断驶过，运走皇帝、国王和公爵们偷走的财物；但法军的逃亡和瓦解过程基本上和以前一样。
     </p>
    </p>
    <p>
     From Moscow to Vyazma the French army of seventy-three thousand men not reckoning the Guards (who did nothing during the whole war but pillage) was reduced to thirty-six thousand, though not more than five thousand had fallen in battle. From this beginning the succeeding terms of the progression could be determined mathematically. The French army melted away and perished at the same rate from Moscow to Vyazma, from Vyazma to Smolensk, from Smolensk to the Berezina, and from the Berezina to Vilna—independently of the greater or lesser intensity of the cold, the pursuit, the barring of the way, or any other particular conditions. Beyond Vyazma the French army instead of moving in three columns huddled together into one mass, and so went on to the end. Berthier wrote to his Emperor (we know how far commanding officers allow themselves to diverge from the truth in describing the condition of an army) and this is what he said:
     <p>
      从莫斯科到维亚兹马，法军的七万三千人（不包括近卫军，他们在整个战争期间除了掠夺什么也没干）减少到了三万六千人，尽管阵亡的不超过五千人。从这一开端，可以用数学方法确定接下来的进程。从莫斯科到维亚兹马，从维亚兹马到斯摩棱斯克，从斯摩棱斯克到别列津纳，从别列津纳到维尔纳，法军以同样的速度消亡--这与寒冷、追击、道路阻隔或任何其他特殊条件的强弱无关。过了维亚兹马，法军不再分三路纵队前进，而是挤成一团，一直冲到最后。贝尔蒂埃给他的皇帝写了一封信（我们知道指挥官在描述一支军队的状况时会让自己偏离事实有多远），他是这样说的：
     </p>
    </p>
    <p>
     I deem it my duty to report to Your Majesty the condition of the various corps I have had occasion to observe during different stages of the last two or three days' march. They are almost disbanded. Scarcely a quarter of the soldiers remain with the standards of their regiments, the others go off by themselves in different directions hoping to find food and escape discipline. In general they regard Smolensk as the place where they hope to recover. During the last few days many of the men have been seen to throw away their cartridges and their arms. In such a state of affairs, whatever your ultimate plans may be, the interest of Your Majesty's service demands that the army should be rallied at Smolensk and should first of all be freed from ineffectives, such as dismounted cavalry, unnecessary baggage, and artillery material that is no longer in proportion to the present forces. The soldiers, who are worn out with hunger and fatigue, need these supplies as well as a few days' rest. Many have died these last days on the road or at the bivouacs. This state of things is continually becoming worse and makes one fear that unless a prompt remedy is applied the troops will no longer be under control in case of an engagement.
     <p>
      我认为我有责任向陛下报告我在过去两三天行军的不同阶段所观察到的各军团的状况。他们几乎解散了。几乎只有四分之一的士兵还跟着自己军团的标兵，其他的人都独自向不同的方向走去，希望能找到食物和逃脱纪律的约束。他们普遍认为斯摩棱斯克是他们希望恢复的地方。在过去的几天里，人们看到许多人扔掉了子弹和武器。在这种情况下，无论您的最终计划是什么，为了陛下的利益，军队应该在斯摩棱斯克集结，首先应该清除无效的东西，如下马骑兵、不必要的辎重和与现有兵力不相称的火炮材料。因饥饿和疲劳而疲惫不堪的士兵们需要这些物资，也需要几天的休息。最近几天，许多人死在了路上或宿营地。这种情况在不断恶化，让人担心除非及时采取补救措施，否则一旦发生交战，部队将无法控制。
     </p>
    </p>
    <p>
     November 9: twenty
     <span data-begin="171.729" data-dur="0.350">
      miles
     </span>
     <span data-begin="172.079" data-dur="0.199">
      from
     </span>
     <span data-begin="172.279" data-dur="1.000">
      Smolensk
     </span>
     .
     <p>
      11月9日：距离斯摩棱斯克二十英里。
     </p>
    </p>
    <p>
     <span data-begin="175.159" data-dur="0.269">
      After
     </span>
     <span data-begin="175.430" data-dur="0.459">
      staggering
     </span>
     <span data-begin="175.889" data-dur="0.220">
      into
     </span>
     <span data-begin="176.110" data-dur="0.610">
      Smolensk
     </span>
     <span data-begin="176.720" data-dur="0.218">
      which
     </span>
     <span data-begin="176.939" data-dur="0.210">
      seemed
     </span>
     <span data-begin="177.150" data-dur="0.078">
      to
     </span>
     <span data-begin="177.229" data-dur="0.190">
      them
     </span>
     <span data-begin="177.449" data-dur="0.060">
      a
     </span>
     <span data-begin="177.510" data-dur="0.508">
      promised
     </span>
     <span data-begin="178.019" data-dur="0.399">
      land
     </span>
     ,
     <span data-begin="178.739" data-dur="0.089">
      the
     </span>
     <span data-begin="178.830" data-dur="0.429">
      French
     </span>
     ,
     <span data-begin="179.519" data-dur="0.350">
      searching
     </span>
     <span data-begin="179.869" data-dur="0.110">
      for
     </span>
     <span data-begin="179.979" data-dur="0.480">
      food
     </span>
     ,
     <span data-begin="180.769" data-dur="0.310">
      killed
     </span>
     <span data-begin="181.080" data-dur="0.140">
      one
     </span>
     <span data-begin="181.220" data-dur="0.520">
      another
     </span>
     ,
     <span data-begin="181.819" data-dur="0.380">
      sacked
     </span>
     <span data-begin="182.229" data-dur="0.140">
      their
     </span>
     <span data-begin="182.400" data-dur="0.229">
      own
     </span>
     <span data-begin="182.629" data-dur="1.000">
      stores
     </span>
     ,
     <span data-begin="183.669" data-dur="0.160">
      and
     </span>
     <span data-begin="183.830" data-dur="0.128">
      when
     </span>
     <span data-begin="183.959" data-dur="0.380">
      everything
     </span>
     <span data-begin="184.339" data-dur="0.149">
      had
     </span>
     <span data-begin="184.489" data-dur="0.179">
      been
     </span>
     <span data-begin="184.669" data-dur="0.510">
      plundered
     </span>
     <span data-begin="185.309" data-dur="0.320">
      fled
     </span>
     <span data-begin="185.629" data-dur="1.000">
      farther
     </span>
     .
     <p>
      法国人踉踉跄跄地进入斯摩棱斯克（对他们来说似乎是一片应许之地）后，为了寻找食物，他们互相残杀，洗劫自己的仓库，当所有东西都被洗劫一空后，便逃得更远了。
     </p>
    </p>
    <p>
     <span data-begin="187.199" data-dur="0.120">
      They
     </span>
     <span data-begin="187.319" data-dur="0.229">
      all
     </span>
     <span data-begin="187.550" data-dur="0.229">
      went
     </span>
     <span data-begin="187.809" data-dur="0.359">
      without
     </span>
     <span data-begin="188.169" data-dur="0.380">
      knowing
     </span>
     <span data-begin="188.550" data-dur="0.350">
      whither
     </span>
     <span data-begin="188.930" data-dur="0.260">
      or
     </span>
     <span data-begin="189.229" data-dur="0.299">
      why
     </span>
     <span data-begin="189.560" data-dur="0.108">
      they
     </span>
     <span data-begin="189.669" data-dur="0.099">
      were
     </span>
     <span data-begin="189.770" data-dur="1.000">
      going
     </span>
     .
     <span data-begin="191.019" data-dur="0.359">
      Still
     </span>
     <span data-begin="191.379" data-dur="0.340">
      less
     </span>
     <span data-begin="191.720" data-dur="0.130">
      did
     </span>
     <span data-begin="191.850" data-dur="0.188">
      that
     </span>
     <span data-begin="192.039" data-dur="0.610">
      genius
     </span>
     ,
     <span data-begin="192.649" data-dur="0.560">
      Napoleon
     </span>
     ,
     <span data-begin="193.209" data-dur="0.210">
      know
     </span>
     <span data-begin="193.419" data-dur="0.190">
      it
     </span>
     ,
     <span data-begin="193.800" data-dur="0.278">
      for
     </span>
     <span data-begin="194.079" data-dur="0.210">
      no
     </span>
     <span data-begin="194.289" data-dur="0.179">
      one
     </span>
     <span data-begin="194.499" data-dur="0.329">
      issued
     </span>
     <span data-begin="194.829" data-dur="0.229">
      any
     </span>
     <span data-begin="195.059" data-dur="0.399">
      orders
     </span>
     <span data-begin="195.459" data-dur="0.099">
      to
     </span>
     <span data-begin="195.589" data-dur="1.000">
      him
     </span>
     .
     <span data-begin="197.230" data-dur="0.160">
      But
     </span>
     <span data-begin="197.390" data-dur="0.278">
      still
     </span>
     <span data-begin="197.669" data-dur="0.359">
      he
     </span>
     <span data-begin="198.029" data-dur="0.160">
      and
     </span>
     <span data-begin="198.189" data-dur="0.210">
      those
     </span>
     <span data-begin="198.400" data-dur="0.320">
      about
     </span>
     <span data-begin="198.720" data-dur="0.250">
      him
     </span>
     <span data-begin="198.970" data-dur="0.388">
      retained
     </span>
     <span data-begin="199.359" data-dur="0.110">
      their
     </span>
     <span data-begin="199.509" data-dur="0.240">
      old
     </span>
     <span data-begin="199.779" data-dur="0.480">
      habits
     </span>
     :
     <span data-begin="200.529" data-dur="0.199">
      wrote
     </span>
     <span data-begin="200.730" data-dur="0.710">
      commands
     </span>
     ,
     <span data-begin="201.499" data-dur="0.420">
      letters
     </span>
     ,
     <span data-begin="201.959" data-dur="0.580">
      reports
     </span>
     ,
     <span data-begin="202.570" data-dur="0.160">
      and
     </span>
     <span data-begin="202.730" data-dur="0.299">
      orders
     </span>
     <span data-begin="203.029" data-dur="0.089">
      of
     </span>
     <span data-begin="203.159" data-dur="0.099">
      the
     </span>
     <span data-begin="203.259" data-dur="0.420">
      day
     </span>
     ;
     <span data-begin="204.099" data-dur="0.290">
      called
     </span>
     <span data-begin="204.390" data-dur="0.118">
      one
     </span>
     <span data-begin="204.509" data-dur="0.380">
      another
     </span>
     <span data-begin="204.989" data-dur="0.650">
      sire
     </span>
     ,
     <span data-begin="205.699" data-dur="0.220">
      mon
     </span>
     <span data-begin="205.919" data-dur="0.560">
      cousin
     </span>
     ,
     <span data-begin="206.529" data-dur="0.429">
      prince
     </span>
     <span data-begin="206.959" data-dur="0.680">
      d'Eckmuhl
     </span>
     ,
     <span data-begin="207.789" data-dur="0.260">
      roi
     </span>
     <span data-begin="208.050" data-dur="1.000">
      de
     </span>
     Naples, and so on. But these orders and reports were only on paper, nothing in them was acted upon for they could not be carried out, and though they entitled one another Majesties, Highnesses, or Cousins, they all felt that they were miserable wretches who had done much evil for which they had now to pay. And though they pretended to be concerned about the army, each was thinking only of himself and of how to get away quickly and save himself.
     <p>
      他们都不知道自己要去哪里，为什么要去。天才拿破仑更不知道，因为没有人向他下达任何命令。但他和他身边的人仍然保留着他们的老习惯：写命令、书信、报告和当天的命令；互相称呼陛下、堂兄、埃克穆尔王子、那不勒斯王等等。但这些命令和报告只是纸上谈兵，没有任何行动，因为它们无法执行。虽然他们互相称呼对方为陛下、殿下或堂兄，但他们都觉得自己是可怜虫，做了很多坏事，现在必须为此付出代价。虽然他们假装关心军队，但每个人都只想着自己，想着如何尽快离开，拯救自己。
     </p>
    </p>
   </div>
  </article>
  <footer class="credits">
   <p>
    阅读外语经典，了解世界文化，复兴中华文明
   </p>
   <p>
    听语族外语软件工作室出品 湖南长沙 联系人：李涉川 微信 Tingyuzu.
   </p>
  </footer>
 </body>
 <script type="text/javascript">
  /**
 * HTML5 Audio Read-Along
 * @author Weston Ruter, X-Team
 * @license MIT/GPL
 * https://github.com/westonruter/html5-audio-read-along
 */
var ReadAlong = {
    text_element: null,
    audio_element: null,
    autofocus_current_word: true,

    words: [],

    init: function (args) {
        var name;
        for (name in args) {
            this[name] = args[name];
        }
        this.generateWordList();
        this.addEventListeners();
        this.selectCurrentWord();
    },

    /**
     * Build an index of all of the words that can be read along with their begin,
     * and end times, and the DOM element representing the word.
     */
    generateWordList: function () {
        var word_els = this.text_element.querySelectorAll('[data-begin]');
        this.words = Array.prototype.map.call(word_els, function (word_el, index) {
            var word = {
                'begin': parseFloat(word_el.dataset.begin),
                'dur': parseFloat(word_el.dataset.dur),
                'element': word_el
            };
            word_el.tabIndex = 0; // to make it focusable/interactive
            word.index = index;
            word.end = word.begin + word.dur;
            word_el.dataset.index = word.index;
            return word;
        });
    },

    /**
     * From the audio's currentTime, find the word that is currently being played
     * @todo this would better be implemented as a binary search
     */
    getCurrentWord: function () {
        var i;
        var len;
        var is_current_word;
        var word = null;
        for (i = 0, len = this.words.length; i < len; i += 1) {
            is_current_word = (
                (
                    this.audio_element.currentTime >= this.words[i].begin
                    &&
                    this.audio_element.currentTime < this.words[i].end
                )
                ||
                (this.audio_element.currentTime < this.words[i].begin)
            );
            if (is_current_word) {
                word = this.words[i];
                break;
            }
        }

        if (!word) {
            throw Error('Unable to find current word and we should always be able to.');
        }
        return word;
    },

    _current_end_select_timeout_id: null,
    _current_next_select_timeout_id: null,

    /**
     * Select the current word and set timeout to select the next one if playing
     */
    selectCurrentWord: function() {
        var that = this;
        var current_word = this.getCurrentWord();
        var is_playing = !this.audio_element.paused;

        if (!current_word.element.classList.contains('speaking')) {
            this.removeWordSelection();
            current_word.element.classList.add('speaking');
            if (this.autofocus_current_word) {
                current_word.element.focus();
            }
        }

        /**
         * The timeupdate Media event does not fire repeatedly enough to be
         * able to rely on for updating the selected word (it hovers around
         * 250ms resolution), so we add a setTimeout with the exact duration
         * of the word.
         */
        if (is_playing) {
            // Remove word selection when the word ceases to be spoken
            var seconds_until_this_word_ends = current_word.end - this.audio_element.currentTime; // Note: 'word' not 'world'! ;-)
            if (typeof this.audio_element === 'number' && !isNaN(this.audio_element)) {
                seconds_until_this_word_ends *= 1.0/this.audio_element.playbackRate;
            }
            clearTimeout(this._current_end_select_timeout_id);
            this._current_end_select_timeout_id = setTimeout(
                function () {
                    if (!that.audio_element.paused) { // we always want to have a word selected while paused
                        current_word.element.classList.remove('speaking');
                    }
                },
                Math.max(seconds_until_this_word_ends * 1000, 0)
            );

            // Automatically trigger selectCurrentWord when the next word begins
            var next_word = this.words[current_word.index + 1];
            if (next_word) {
                var seconds_until_next_word_begins = next_word.begin - this.audio_element.currentTime;

                var orig_seconds_until_next_word_begins = seconds_until_next_word_begins; // temp
                if (typeof this.audio_element === 'number' && !isNaN(this.audio_element)) {
                    seconds_until_next_word_begins *= 1.0/this.audio_element.playbackRate;
                }
                clearTimeout(this._current_next_select_timeout_id);
                this._current_next_select_timeout_id = setTimeout(
                    function () {
                        that.selectCurrentWord();
                    },
                    Math.max(seconds_until_next_word_begins * 1000, 0)
                );
            }
        }

    },

    removeWordSelection: function() {
        // There should only be one element with .speaking, but selecting all for good measure
        var spoken_word_els = this.text_element.querySelectorAll('span[data-begin].speaking');
        Array.prototype.forEach.call(spoken_word_els, function (spoken_word_el) {
            spoken_word_el.classList.remove('speaking');
        });
    },


    addEventListeners: function () {
        var that = this;

        /**
         * Select next word (at that.audio_element.currentTime) when playing begins
         */
        that.audio_element.addEventListener('play', function (e) {
            that.selectCurrentWord();
            that.text_element.classList.add('speaking');
        }, false);

        /**
         * Abandon seeking the next word because we're paused
         */
        that.audio_element.addEventListener('pause', function (e) {
            that.selectCurrentWord(); // We always want a word to be selected
            that.text_element.classList.remove('speaking');
        }, false);

        /**
         * Seek by selecting a word (event delegation)
         */
        function on_select_word_el(e) {
            if (!e.target.dataset.begin) {
                return;
            }
            e.preventDefault();

            var i = e.target.dataset.index;
            that.audio_element.currentTime = that.words[i].begin + 0.01; //Note: times apparently cannot be exactly set and sometimes select too early
            that.selectCurrentWord();
        }
        that.text_element.addEventListener('click', on_select_word_el, false);
        that.text_element.addEventListener('keypress', function (e) {
            if ( (e.charCode || e.keyCode) === 13 /*Enter*/) {
                on_select_word_el.call(this, e);
            }
        }, false);

        /**
         * Spacebar toggles playback
         */
        document.addEventListener('keypress', function (e) {
            if ( (e.charCode || e.keyCode) === 32 /*Space*/) {
                e.preventDefault();
                if (that.audio_element.paused) {
                    that.audio_element.play();
                }
                else {
                    that.audio_element.pause();
                }
            }
        }, false);

        /**
         * First click handler sets currentTime to the word, and second click
         * here then causes it to play.
         * @todo Should it stop playing once the duration is over?
         */
        that.text_element.addEventListener('dblclick', function (e) {
            e.preventDefault();
            that.audio_element.play();
        }, false);

        /**
         * Select a word when seeking
         */
        that.audio_element.addEventListener('seeked', function (e) {
            that.selectCurrentWord();

            /**
             * Address probem with Chrome where sometimes it seems to get stuck upon seeked:
             * http://code.google.com/p/chromium/issues/detail?id=99749
             */
            var audio_element = this;
            if (!audio_element.paused) {
                var previousTime = audio_element.currentTime;
                setTimeout(function () {
                    if (!audio_element.paused && previousTime === audio_element.currentTime) {
                        audio_element.currentTime += 0.01; // Attempt to unstick
                    }
                }, 500);
            }
        }, false);

        /**
         * Select a word when seeking
         */
        that.audio_element.addEventListener('ratechange', function (e) {
            that.selectCurrentWord();
        }, false);
    }
};
 </script>
 <script type="text/javascript">
  /*global ReadAlong */
window.addEventListener('load', function (e) {
    try {
        var args = {
            text_element: document.getElementById('passage-text'),
            audio_element: document.getElementById('passage-audio'),
            autofocus_current_word: document.getElementById('autofocus-current-word').checked
        };

        if (!args.audio_element.canPlayType) {
            // No error messaging is needed because error message appears in <audio> fallback
            throw new Error('HTML5 Audio not supported');
        }
        if (args.audio_element.networkState === args.audio_element.NETWORK_NO_SOURCE) {
            document.querySelector('.passage-audio-unavailable').hidden = false;
            throw new Error('Cannot play any of the available sources');
        }

        var supports_playback_rate = (function (audio) {
            if (typeof audio.playbackRate !== 'number' || isNaN(audio.playbackRate)) {
                return false;
            }

            // For Opera, since it doesn't currently support playbackRate and yet
            // has it defined as 1.0, we can detect Opera support by changing
            // the playbackRate and see if the change sticks.
            var original_playback_rate = audio.playbackRate;
            audio.playbackRate += 1.0;
            var is_playback_rate_changed = (original_playback_rate !== audio.playbackRate);
            audio.playbackRate = original_playback_rate;
            return is_playback_rate_changed;
        }(args.audio_element));

        if (supports_playback_rate) {
            var rate_range_element = document.getElementById('playback-rate');
            rate_range_element.disabled = false;
            rate_range_element.addEventListener('change', function (e) {
                args.audio_element.playbackRate = this.valueAsNumber;
            }, false);
        }
        else {
            document.querySelector('.playback-rate-unavailable').hidden = false;
        }

        ReadAlong.init(args);

        document.getElementById('autofocus-current-word').addEventListener('change', function (e) {
            ReadAlong.autofocus_current_word = this.checked;
        }, false);

        document.querySelector('.passage-audio').hidden = false;
        if (supports_playback_rate) {
            document.querySelector('.playback-rate').hidden = false;
        }
        document.querySelector('.autofocus-current-word').hidden = false;
    }
    catch (err) {
        console.error(err);
    }
    document.body.classList.add('initialized');
    document.querySelector('.loading').hidden = true;
}, false);
 </script>
</html>
